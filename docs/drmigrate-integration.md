# Dr. Migrate Integration

This document describes how to generate architecture recommendation context files from Dr. Migrate data sources, enabling architecture recommendations for ALL applications—not just those with Java/.NET App Cat scans.

## Overview

The Architecture Scorer typically requires context files generated by the App Cat (Application Categorizer) process, which only works for applications with Java or .NET components. However, Dr. Migrate exposes a wealth of application and infrastructure data via its LLM-accessible views that can be used to generate compatible context files for any application.

This integration allows you to:
- Generate context files for applications without Java/.NET components
- Leverage existing Dr. Migrate data without additional scanning
- Get architecture recommendations for your entire application portfolio

## Quick Start: Web Upload

The easiest way to use Dr. Migrate data is through the Recommendations App:

1. **Get the LLM Prompt**: In the Recommendations App, expand "How to get data from Dr. Migrate AI Advisor" on the home page
2. **Generate Data**: Copy the prompt into Dr. Migrate AI Advisor, replacing `YOUR_APPLICATION_NAME` with your app name
3. **Save the Response**: Copy the JSON response and save it as a `.json` file
4. **Upload**: Upload the file to the Recommendations App - it auto-detects the format and converts it

If validation fails, the app shows the LLM prompt again with specific suggestions for fixing the data.

## LLM Prompt for Dr. Migrate AI Advisor

Copy this prompt into Dr. Migrate AI Advisor to extract data for any application:

```
For the application "YOUR_APPLICATION_NAME", please extract and return ALL available data as a JSON object.

Query these data sources and return the complete information:

**Required Data Sources:**
1. Application_Overview - all fields for this application
2. Server_Overview_Current - all servers belonging to this application
3. InstalledApplications - all software installed on each server
4. Key_Software - key software detected for this application
5. Cloud_Server_Cost - projected cloud costs per server
6. Current_Server_Cost - current on-premises costs per server
7. Application_Cost_Comparison - aggregated cost comparison
8. App_Modernization_Candidates - modernization candidate technologies (if any)
9. network_application_overview - application dependencies (if available)

Return the data in this exact JSON structure:

{
  "application_overview": {
    "application": "",
    "number_of_machines": null,
    "number_of_environments": null,
    "environment_names": "",
    "planned_migration_wave": "",
    "migration_squad": "",
    "migration_start_date": "",
    "migration_end_date": "",
    "complexity_rating": "",
    "migration_scope": "",
    "app_function": "",
    "app_type": "",
    "app_owner": "",
    "app_sme": "",
    "high_availability": "",
    "business_critical": "",
    "inherent_risk": "",
    "materiality": "",
    "pii_data": "",
    "disaster_recovery": "",
    "number_of_unique_operating_systems": "",
    "unique_operating_systems": "",
    "number_of_machines_with_out_of_support_OS": "",
    "sql_server_count": "",
    "non_sql_databases": "",
    "other_tech_stack_components": "",
    "assigned_migration_strategy": "",
    "suitable_migration_strategy_options": "",
    "detected_app_components": "",
    "app_component_modernization_options": ""
  },
  "server_overviews": [
    {
      "machine": "",
      "application": "",
      "environment": "",
      "OperatingSystem": "",
      "os_support_status": "",
      "PowerStatus": "",
      "CloudVMReadiness": "",
      "AllocatedMemoryInGB": null,
      "Cores": null,
      "CPUUsageInPct": null,
      "MemoryUsageInPct": null,
      "StorageGB": null,
      "DiskReadOpsPerSec": null,
      "DiskWriteOpsPerSec": null,
      "NetworkInMBPS": "",
      "NetworkOutMBPS": ""
    }
  ],
  "installed_applications": [
    {
      "machine": "",
      "key_software": "",
      "key_software_category": "",
      "key_software_type": "",
      "specific_software_detected": ""
    }
  ],
  "key_software": [
    {
      "application": "",
      "key_software": "",
      "key_software_category": ""
    }
  ],
  "cloud_server_costs": [
    {
      "machine": "",
      "application": "",
      "assigned_treatment": "",
      "assigned_target": "",
      "cloud_compute_cost_annual": null,
      "cloud_storage_cost_annual": null,
      "cloud_total_cost_annual": null
    }
  ],
  "current_server_costs": [
    {
      "machine": "",
      "hardware_cost_annual": null,
      "software_cost_annual": null,
      "electricity_cost_annual": null,
      "data_center_cost_annual": null,
      "virtualisation_cost_annual": null,
      "networking_cost_annual": null,
      "storage_cost_annual": null,
      "backup_cost_annual": null,
      "disaster_recovery_cost_annual": null,
      "total_cost_annual": null
    }
  ],
  "app_mod_candidates": [
    {
      "application": "",
      "app_mod_candidate_technology": "",
      "number_of_machines_with_tech": null
    }
  ],
  "cost_comparison": {
    "application": "",
    "current_total_cost_annual": null,
    "cloud_compute_cost_annual": null,
    "cloud_storage_cost_annual": null,
    "cloud_total_cost_annual": null,
    "Currency": "",
    "Symbol": ""
  },
  "network_dependencies": [
    {
      "source_application": "",
      "destination_application": "",
      "port": ""
    }
  ]
}

**Important Instructions:**
- Include ALL servers associated with this application
- Include ALL installed software on each server
- Use null for missing numeric values, empty string "" for missing text
- If a data source returns no results, use an empty array []
- Return ONLY the JSON object, no additional text or explanation
```

Replace `YOUR_APPLICATION_NAME` with the actual application name before using.

## Data Source Mapping

The following table shows how Dr. Migrate data sources map to context file fields:

| Context File Section | Dr. Migrate Source | Notes |
|---------------------|-------------------|-------|
| `app_overview` | `Application_Overview` | Direct mapping for most fields |
| `server_details` | `Server_Overview_Current` | Server config and performance |
| `detected_technology_running` | Multiple sources | Combined from tech stack, installed apps, key software |
| `app_approved_azure_services` | Inferred + `Cloud_Server_Cost` | Based on technology and assigned targets |
| `App Mod results` | `App_Modernization_Candidates` | Partial/inferred for non-Java/.NET apps |

### Detailed Field Mappings

#### app_overview
| Context Field | Dr. Migrate Field | Notes |
|--------------|-------------------|-------|
| `application` | `application` | Direct mapping |
| `app_type` | `app_type`, `app_function` | Falls back through available fields |
| `business_crtiticality` | `business_critical`, `inherent_risk`, `materiality` | Derived from multiple indicators |
| `treatment` | `assigned_migration_strategy` | Mapped to 7R strategy |
| `owner` | `app_owner` | Direct mapping |

#### server_details
| Context Field | Dr. Migrate Field | Notes |
|--------------|-------------------|-------|
| `machine` | `machine` | Direct mapping |
| `environment` | `environment` | Direct mapping |
| `OperatingSystem` | `OperatingSystem` | Direct mapping |
| `MemoryGB` | `AllocatedMemoryInGB` | Direct mapping |
| `Cores` | `Cores` | Direct mapping |
| `CPUUsage` | `CPUUsageInPct` | Direct mapping |
| `MemoryUsage` | `MemoryUsageInPct` | Direct mapping |
| `AzureVMReadiness` | `CloudVMReadiness` | Mapped to Ready/ReadyWithConditions/NotReady |
| `detected_COTS` | `Installed_Applications.key_software` | Per-server software |

## CLI Usage

### Generate Context from Dr. Migrate Data

```bash
# Generate context file from Dr. Migrate data
architecture-scorer generate-context -i drmigrate-data.json -o context.json

# Include cost comparison data
architecture-scorer generate-context -i drmigrate-data.json -o context.json --include-costs

# Include network dependency data
architecture-scorer generate-context -i drmigrate-data.json -o context.json --include-network

# Output to stdout (compact JSON)
architecture-scorer generate-context -i drmigrate-data.json --compact
```

### Generate Sample Input File

```bash
# Create a sample Dr. Migrate input file to see the expected format
architecture-scorer generate-sample-drmigrate -o sample.json -n "MyApplication"

# Then generate context from the sample
architecture-scorer generate-context -i sample.json -o context.json

# Score the application
architecture-scorer score -c architecture-catalog.json -x context.json
```

## Input Format

The generator accepts JSON in the following format:

### Single Application

```json
{
  "application_overview": {
    "application": "MyApp",
    "number_of_machines": 3,
    "number_of_environments": 2,
    "environment_names": "Production, Development",
    "complexity_rating": "Medium",
    "app_type": "In-house",
    "app_owner": "IT Department",
    "business_critical": "Yes",
    "high_availability": "Yes",
    "assigned_migration_strategy": "Replatform",
    "other_tech_stack_components": "Java 11, Spring Boot, PostgreSQL"
  },
  "server_overviews": [
    {
      "machine": "APP-WEB-01",
      "application": "MyApp",
      "environment": "Production",
      "OperatingSystem": "Ubuntu 20.04",
      "CloudVMReadiness": "Ready",
      "AllocatedMemoryInGB": 8.0,
      "Cores": 4,
      "CPUUsageInPct": 45.5,
      "StorageGB": 100.0
    }
  ],
  "installed_applications": [
    {
      "machine": "APP-WEB-01",
      "key_software": "Java 11",
      "key_software_category": "Runtime"
    }
  ],
  "key_software": [
    {
      "application": "MyApp",
      "key_software": "Spring Boot"
    }
  ],
  "cloud_server_costs": [
    {
      "machine": "APP-WEB-01",
      "assigned_treatment": "Replatform",
      "assigned_target": "Azure App Service"
    }
  ],
  "app_mod_candidates": [
    {
      "application": "MyApp",
      "app_mod_candidate_technology": "Java"
    }
  ]
}
```

### Multiple Applications

```json
[
  { "application_overview": { "application": "App1", ... }, ... },
  { "application_overview": { "application": "App2", ... }, ... }
]
```

## Programmatic Usage

### Python API

```python
from architecture_scorer.drmigrate_generator import DrMigrateContextGenerator
from architecture_scorer.drmigrate_schema import (
    DrMigrateApplicationData,
    DrMigrateApplicationOverview,
    DrMigrateServerOverview,
)

# Create application data
app_data = DrMigrateApplicationData(
    application_overview=DrMigrateApplicationOverview(
        application="MyApp",
        business_critical="Yes",
        assigned_migration_strategy="Replatform",
        other_tech_stack_components="Java 11, Spring Boot",
    ),
    server_overviews=[
        DrMigrateServerOverview(
            machine="APP-WEB-01",
            environment="Production",
            OperatingSystem="Ubuntu 20.04",
            CloudVMReadiness="Ready",
        )
    ],
)

# Generate context
generator = DrMigrateContextGenerator(
    include_cost_data=True,
    include_network_data=False,
)
context = generator.generate_context(app_data)

# Output as JSON
json_str = generator.generate_context_json(app_data, indent=2)

# Batch processing
apps = [app_data1, app_data2, app_data3]
results = generator.generate_batch_contexts(apps)
```

### Custom Azure Service Mappings

```python
custom_mappings = {
    "Custom Database": "Azure SQL Database",
    "Legacy Middleware": "Azure Kubernetes Service",
}

generator = DrMigrateContextGenerator(
    azure_service_mappings=custom_mappings
)
```

### Custom Modernization Pathway Mappings

You can override the default Azure modernization pathway mappings:

```python
custom_pathways = {
    "MyCustomFramework": {
        "rehost": "Azure Virtual Machines",
        "replatform": "Azure App Service",
        "refactor": "Azure Container Apps",
        "azure_equivalent": "Azure App Service",
        "modernization_path": ["Azure VMs", "Azure App Service", "Azure Container Apps"],
        "notes": "Custom framework guidance here",
        "blockers": ["Known limitation 1"],
    },
}

generator = DrMigrateContextGenerator(
    compatibility_mappings=custom_pathways
)
```

## ⚠️ Important: Inferred vs Scanned Results

**This is critical to understand:**

| Source | Analysis Type | Confidence | Details |
|--------|---------------|------------|---------|
| **App Cat Scan** | Actual code analysis | **High** | Scans Java/.NET source code, detects API usage, identifies blockers |
| **Dr. Migrate Export** | Inferred from technology patterns | **Low** | Based on technology type, not actual code |

When using Dr. Migrate exports (non-Java/.NET apps), the platform compatibility assessments are **educated guesses** based on:
- The detected technology name (e.g., "PHP", "Python", "NGINX")
- General characteristics of that technology
- Common Azure deployment patterns

**What this means:**
- Compatibility marked as "Supported" doesn't guarantee the app will work without issues
- Custom code, specific dependencies, or configuration may cause problems not detected
- Manual validation is recommended before making migration decisions

Generated App Mod results include warnings:
```json
{
  "summary": {
    "inferred_from_dr_migrate": true,
    "no_appcat_scan": true,
    "confidence": "Low",
    "warning": "Compatibility inferred from technology type, not code analysis"
  }
}
```

## Azure Modernization Pathways

The following tables show the Azure modernization pathways for each technology. These map on-premises technologies to their Azure equivalents and recommended migration paths.

**Migration Strategy Targets:**
- **Rehost**: Lift-and-shift target (minimal changes)
- **Replatform**: PaaS target (some configuration changes)
- **Refactor**: Cloud-native target (containerization/serverless)
- **Azure Equivalent**: Direct Azure managed service equivalent

### Java Ecosystem

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| Java | Azure VMs | Azure App Service | Azure Kubernetes Service | Azure App Service (Java) |
| Spring Boot | Azure VMs | Azure Spring Apps | Azure Kubernetes Service | Azure Spring Apps |
| Apache Tomcat | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service (Tomcat) |
| JBoss/WildFly | Azure VMs | Azure Red Hat OpenShift | Azure Kubernetes Service | Azure Red Hat OpenShift |

### .NET Ecosystem

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| .NET Core | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service |
| .NET Framework | Azure VMs | Azure App Service (Windows) | Migrate to .NET 6+ | Azure Virtual Machines |
| ASP.NET Core | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service |
| ASP.NET | Azure VMs | Azure App Service (Windows) | Migrate to ASP.NET Core | Azure App Service (Windows) |

### Python Ecosystem

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| Python | Azure VMs | Azure App Service | Azure Functions | Azure App Service (Python) |
| Django | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service (Python) |
| Flask | Azure VMs | Azure App Service | Azure Functions | Azure App Service (Python) |
| FastAPI | Azure VMs | Azure Container Apps | Azure Container Apps | Azure Container Apps |

### Node.js Ecosystem

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| Node.js | Azure VMs | Azure App Service | Azure Functions | Azure App Service (Node) |
| Express.js | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service (Node) |
| Next.js | Azure VMs | Azure Static Web Apps | Azure Static Web Apps | Azure Static Web Apps |

### PHP Ecosystem

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| PHP | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service (PHP) |
| Laravel | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service (PHP) |
| Symfony | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service (PHP) |
| WordPress | Azure VMs | Azure App Service | Azure App Service + CDN | Azure App Service (WordPress) |
| Drupal | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service (PHP) |
| Magento | Azure VMs | Azure Kubernetes Service | Azure Kubernetes Service | Azure Kubernetes Service |

### Ruby Ecosystem

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| Ruby | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service (Ruby) |
| Ruby on Rails | Azure VMs | Azure App Service | Azure Container Apps | Azure App Service (Ruby) |

### Go & Rust

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| Go | Azure VMs | Azure Container Apps | Azure Container Apps | Azure Container Apps |
| Rust | Azure VMs | Azure Container Apps | Azure Container Apps | Azure Container Apps |

### Web Servers

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| NGINX | Azure VMs | Azure Application Gateway | Azure Front Door | Azure Application Gateway / Front Door |
| Apache HTTP | Azure VMs | Azure App Service | Azure Front Door + App Service | Azure App Service |
| Microsoft IIS | Azure VMs | Azure App Service (Windows) | Azure App Service | Azure App Service (Windows) |

### Middleware

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| IBM WebSphere | Azure VMs | Azure Red Hat OpenShift | Azure Kubernetes Service | Azure Red Hat OpenShift |
| Oracle WebLogic | Azure VMs | WebLogic on AKS | Azure Kubernetes Service | Oracle WebLogic on AKS |
| Microsoft BizTalk | Azure VMs | Azure Logic Apps | Azure Logic Apps + Functions | Azure Logic Apps |

### Databases

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| SQL Server | SQL Server on Azure VMs | Azure SQL Managed Instance | Azure SQL Database | Azure SQL Database |
| MySQL | MySQL on Azure VMs | Azure Database for MySQL | Azure Database for MySQL | Azure Database for MySQL |
| PostgreSQL | PostgreSQL on Azure VMs | Azure Database for PostgreSQL | Azure Database for PostgreSQL | Azure Database for PostgreSQL |
| MongoDB | MongoDB on Azure VMs | Azure Cosmos DB for MongoDB | Azure Cosmos DB for MongoDB | Azure Cosmos DB for MongoDB |
| Oracle Database | Oracle on Azure VMs | Oracle Database@Azure | Oracle Database@Azure | Oracle Database@Azure |

### Messaging

| Technology | Rehost | Replatform | Refactor | Azure Equivalent |
|------------|--------|------------|----------|------------------|
| RabbitMQ | RabbitMQ on Azure VMs | Azure Service Bus | Azure Service Bus | Azure Service Bus |
| Apache Kafka | Kafka on Azure VMs | Azure Event Hubs (Kafka API) | Azure Event Hubs | Azure Event Hubs for Apache Kafka |

## Limitations

When generating context files from Dr. Migrate data instead of App Cat scans:

1. **App Mod Results**: The `App Mod results` section will contain inferred/partial data rather than detailed App Cat scan results. This includes:
   - Platform compatibility is inferred from technology type
   - No detailed code-level findings
   - Blockers are not detected (only infrastructure-level issues)

2. **Technology Detection**: Technology detection relies on:
   - `other_tech_stack_components` field
   - `Installed_Applications` data
   - Operating system information

   This may miss some technologies that would be detected by App Cat scanning.

3. **Compatibility Assessment**: Without App Cat scans, compatibility with Azure services is inferred based on general technology patterns rather than code analysis.

## Best Practices

1. **Use App Cat When Available**: For Java and .NET applications, prefer using App Cat scans when possible for more accurate results.

2. **Enrich Technology Data**: Ensure the `other_tech_stack_components` and installed applications data in Dr. Migrate is as complete as possible.

3. **Review Inferred Results**: Context files generated from Dr. Migrate data will include a `_generated_from: dr_migrate` marker and inferred App Mod results will have `inferred_from_dr_migrate: true` in the summary.

4. **Answer Clarification Questions**: Since some data may be incomplete, be prepared to answer more clarification questions during the scoring process.

## Troubleshooting

### Missing Technologies

If technologies aren't being detected:
- Verify `other_tech_stack_components` contains comma-separated technology names
- Check that `installed_applications` data is populated for each server
- Ensure OS information is present in `server_overviews`

### Incorrect Treatment Mapping

The generator maps common strategy names:
- "Lift and Shift" → Rehost
- "Rearchitect" → Refactor
- "Repurchase" → Replace

If your strategy names differ, the original value will be used as-is.

### VM Readiness Issues

VM readiness is mapped from `CloudVMReadiness`:
- "Ready" → Ready
- "Ready with conditions" → ReadyWithConditions
- "Not Ready" / "NotReady" → NotReady
- Other values → Unknown
