# Architecture Recommendations App

A customer-facing web application that provides Azure architecture recommendations based on application context data.

## Prerequisites

This application requires an **application context file** generated by [Dr. Migrate](https://drmigrate.com). Context files are created during the migration planning process when you [assess an application with AppCat](https://learn.drmigrate.com/docs/using-dr-migrate/migration-planning/appcat-github-integration/).

If you don't have a Dr. Migrate context file, you can use the [sample files](../examples/context_files/) for testing.

## Overview

This Streamlit-based application allows customers to:
1. Upload their Dr. Migrate context file (JSON)
2. Review application summary information
3. Answer optional clarification questions
4. Receive tailored architecture recommendations
5. Export results as PDF or JSON

## Installation

```bash
# Clone the repository
git clone https://github.com/adamswbrown/azure-architecture-categoriser-.git
cd azure-architecture-categoriser-

# Install with recommendations app dependencies
pip install -e ".[recommendations-app]"
```

## Quick Start

```bash
# Ensure you have a catalog file (or generate one first)
# See: docs/catalog-builder.md

# Run the application (macOS/Linux)
./bin/start-recommendations-app.sh

# Run the application (Windows PowerShell)
.\bin\start-recommendations-app.ps1
```

The app will open in your browser at `http://localhost:8501`.

![Architecture Recommendations App](images/architecture%20recommendations-gui.png)

## User Flow

The application follows a simple 3-step wizard:

### Step 1: Upload & Review

1. Upload your Dr. Migrate context file (JSON format)
2. Review the **Application Summary**:
   - Application name, type, criticality, treatment
   - Detected technologies
   - Server count and environments
   - Operating system breakdown
   - App Modernization assessment results

### Step 2: Answer Questions

1. Review clarification questions (all optional)
2. Each question shows the current inference and confidence level
3. Providing answers improves recommendation accuracy
4. Questions cover:
   - Migration treatment strategy
   - Availability requirements
   - Security/compliance level
   - Operational maturity
   - Cost optimization priority

### Step 3: Results

1. View **Analysis Summary** with key metrics
2. See the **Primary Recommendation** with:
   - Architecture name and pattern
   - Match score (percentage)
   - Quality badge (Curated, AI Enriched, AI Suggested, Example)
   - Architecture diagram (when available)
   - Description
   - Why it fits / Potential challenges
   - Core Azure services
   - Link to Microsoft Docs
3. Review **Alternative Recommendations**
4. View **Your Answers** (if questions were answered)
5. **Export** results:
   - Download PDF Report
   - Download JSON
   - Start New Analysis

### No Strong Matches

When the scoring engine cannot find architectures that strongly match your requirements, the app displays a helpful guidance screen instead of empty results:

**What you'll see:**
- ⚠️ Warning banner explaining no strong matches were found
- **What we understood** - Key drivers extracted from your context file
- **Possible reasons** - Common explanations for low match scores
- **Suggestions to improve results** - Actionable steps including:
  - Answer unanswered clarification questions
  - Review and enrich your context file
  - Browse Azure Architecture Center manually
  - Consult with an Azure specialist

**Common causes:**
- Unique or specialized technology combinations
- Missing details about scalability or availability requirements
- Context file lacks sufficient technical detail
- Application requirements don't map to standard patterns

**Recommended actions:**
1. Return to Step 2 and answer all clarification questions
2. Ensure your Dr. Migrate context file includes App Modernization results
3. Manually explore the [Azure Architecture Center](https://learn.microsoft.com/azure/architecture/browse) for inspiration

## Context File Format

Context files are generated by Dr. Migrate during the AppCat assessment process. The file is a JSON array containing application assessment data with the following structure:

```json
[
  {
    "app_overview": [
      {
        "application": "MyApplication",
        "app_type": "Web Application",
        "business_criticality": "High",
        "treatment": "replatform"
      }
    ],
    "detected_technology_running": [
      "Java",
      "Spring Boot",
      "PostgreSQL",
      "Redis"
    ],
    "server_details": [
      {
        "ServerName": "app-server-01",
        "environment": "Production",
        "OperatingSystem": "Windows Server 2019"
      }
    ],
    "App Mod results": [
      {
        "technology": "Java",
        "summary": {
          "container_ready": true,
          "modernization_feasible": true
        },
        "recommended_targets": ["Azure App Service", "Azure Kubernetes Service"]
      }
    ]
  }
]
```

### Required Fields

| Field | Description |
|-------|-------------|
| `app_overview` | Array with application metadata |
| `app_overview[].application` | Application name |

### Optional Fields

| Field | Description |
|-------|-------------|
| `app_overview[].app_type` | Application type (Web, API, Batch, etc.) |
| `app_overview[].business_criticality` | Business criticality level |
| `app_overview[].treatment` | Migration treatment (rehost, replatform, refactor, etc.) |
| `detected_technology_running` | Array of detected technologies |
| `server_details` | Array of server information |
| `App Mod results` | App Modernization assessment results |

## Configuration

### Catalog Location

The app looks for the architecture catalog in this order:

1. **User-selected**: Upload or specify path via the sidebar
2. **Environment variable**: `ARCHITECTURE_CATALOG_PATH`
3. **Current directory**: `./architecture-catalog.json`
4. **Project root**: `<project>/architecture-catalog.json`

The sidebar shows the currently loaded catalog including:
- Number of architectures
- Source location
- Last modified date
- Full file path

You can change catalogs at any time using the sidebar:
- **Upload** a catalog JSON file directly
- **Enter a path** to an existing catalog file
- **Reset** to auto-detection

```bash
# Use a custom catalog via environment variable
export ARCHITECTURE_CATALOG_PATH=/path/to/my-catalog.json
./bin/start-recommendations-app.sh
```

### Theme Configuration

The app uses a light theme by default. Configuration is in `.streamlit/config.toml`:

```toml
[theme]
base = "light"
primaryColor = "#0078D4"
backgroundColor = "#FFFFFF"
secondaryBackgroundColor = "#F5F5F5"
textColor = "#333333"
```

## PDF Report

The generated PDF report includes:

1. **Header** - Title, application name, generation date
2. **Executive Summary** - Key metrics in a table
3. **Key Drivers** - Factors driving the recommendations
4. **Key Considerations** - Potential risks or challenges
5. **Your Answers** - Clarification questions you answered (if any)
6. **Recommendations** - Each recommendation with:
   - Architecture diagram (SVG and PNG supported)
   - Match score and quality level
   - Description
   - Why it fits / Potential challenges
   - Core Azure services
   - Learn URL

The PDF generator uses `reportlab` for PDF creation and `svglib` for SVG diagram conversion.

## File Structure

```
src/architecture_recommendations_app/
├── app.py                      # Main Streamlit application
├── components/
│   ├── upload_section.py       # File upload component
│   ├── results_display.py      # Recommendation cards
│   ├── questions_section.py    # Q&A component
│   └── pdf_generator.py        # PDF report generation
├── state/
│   └── session_state.py        # Session state management
├── utils/
│   └── validation.py           # Context file validation
└── .streamlit/
    └── config.toml             # Streamlit configuration
```

## Development

```bash
# Install development dependencies
pip install -e ".[dev,recommendations-app]"

# Run with auto-reload
streamlit run src/architecture_recommendations_app/app.py --server.runOnSave true

# Run tests
pytest tests/
```

## Troubleshooting

### "Architecture catalog not found"

Ensure you have a catalog file. Generate one using:
```bash
catalog-builder build-catalog --repo-path ./architecture-center --out architecture-catalog.json
```

### "Validation Error" on upload

Check that your context file:
- Is valid JSON
- Is an array with at least one object
- Contains `app_overview` with an `application` name

### No images in recommendations

Only ~20% of catalog entries have architecture diagrams. The app gracefully handles missing images.

### PDF generation fails

Ensure `reportlab` and `svglib` are installed:
```bash
pip install reportlab>=4.0.0 svglib>=1.5.0
```

### No recommendations shown

If you see "No Strong Matches Found":
1. Return to Step 2 and answer all clarification questions
2. Verify your context file has detailed technology information
3. Check that App Modernization results are included
4. Consider manually browsing Azure Architecture Center for your use case

## Related Documentation

- [Catalog Builder](./catalog-builder.md) - Generate architecture catalogs
- [Architecture Scorer](./architecture-scorer.md) - Scoring engine details
- [Main README](../README.md) - Project overview
